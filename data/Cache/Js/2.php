        <?php $mid="1";$cid ="1,2,3,4";$listtype ="";$flag='2';$aid=''; $_GET['mid']="1"; if(empty($cid)){ $cid= isset($_GET['cid'])?intval($_GET['cid']):null; } $db = new ContentViewModel(); if($db->table){ $table=$db->table; if(!empty($flag)){ $db->in(array("fid" => $flag)); } if ($cid) { if($listtype=='all'){ $tmp =M("category")->field("cid")->where("path like '%_".$cid."%' or cid=$cid")->all(); $cid=array(); foreach($tmp as $t){ $cid[]=$t['cid']; } if(!empty($cid)&& is_array($cid)){ $db->in = array(C("DB_PREFIX")."category.cid"=>$cid); } }else{ $db->where = C("DB_PREFIX")."category.cid in($cid)"; } } if ($aid) { $db->where=$table.".aid=".$aid; } $db->where="status=1"; $db->group=$table.".aid"; $db->limit(10); $db->field="*,{$db->table}.aid,{$db->table}.cid"; $result = $db->join('category,content_flag')->field("addtime")->all(); if(!empty($result) and is_array($result)){ foreach($result as $field): $field['caturl']=U('category',array('cid'=>$field['cid'])); $field['url']=get_content_url($field); $field['time']=date("Y-m-d",$field['addtime']); $field['thumb']='__ROOT__'.'/'.$field['thumb']; $field['title']=mb_substr($field['title'],0,80,'utf8'); $field['title']=$field['color']?"<span style='color:".$field['color']."'>".$field['title']."</span>":$field['title']; $field['description']=mb_substr($field['description'],0,80,'utf-8'); ?><li>
                <a href="<?php echo get_content_url($field);?>" target="">
                    [<?php echo date("Y-m-d",$field["addtime"]);?>]<?php echo $field["title"]?>
                </a>
                </li><?php endforeach;}}?>