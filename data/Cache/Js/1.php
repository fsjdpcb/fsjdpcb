        <?php $mid="1";$cid ='';$flag='';$aid=''; if(empty($cid)){ $cid= Q('cid',NULL,'intval'); } if(empty($cid)){ $tmp = M('category')->where('mid=1')->getField('cid',true); if($tmp) $cid=implode(',',$tmp); } if($cid){ $cid = explode(',',preg_replace('@\s@','',$cid)); import('Content.Model.ContentViewModel'); $db = K('ContentView',array('cid'=>$cid[0])); $table=$db->tableFull; if(!empty($flag)){ $db->in(array("fid" => $flag)); } $db->where = $table.'.cid in('.implode(',',$cid).')'; if ($aid) { $db->where=$table.'.aid IN('.$aid.')'; } $db->where=$table.'.state=1'; $db->group=$table.'.aid'; $db->limit(10); $field = "*,$table.cid,$table.aid"; $db->field($field); $result = $db->join('category,content_flag')->order('arc_sort ASC,updatetime DESC')->all(); if($result){ foreach($result as $field): $field['caturl']=U('category',array('cid'=>$field['cid'])); $field['url']=Url::get_content_url($field); $field['time']=date("Y-m-d",$field['updatetime']); $field['thumb']='__ROOT__'.'/'.$field['thumb']; $field['title']=mb_substr($field['title'],0,80,'utf8'); $field['title']=$field['color']?"<span style='color:".$field['color']."'>".$field['title']."</span>":$field['title']; $field['description']=mb_substr($field['description'],0,80,'utf-8'); ?><li>
                <a href="<?php echo get_content_url($field);?>" target="">
                    [<?php echo date("Y-m-d",$field["addtime"]);?>]<?php echo $field["title"]?>
                </a>
                </li><?php endforeach;}}?>